\chapter{Managing processing flows using SCons}

There are several options for doing data processing using Madagascar:
you can run programs on the command line, you can collect a sequence
of commands in a Shell script or a Python script. A superior
alternative, as this chapter explains, is to use a workflow management
tool, such as SCons.

\section{What is SCons?}

SCons stands for \emph{Sofware Construction} and is a tool designed
primarily for compiling software \cite[]{scons}, as a modern
replacement for the Unix \texttt{make} utility \cite[]{make}. The
SCons configuration files (\texttt{SConstruct} scripts) are written in
the Python programming language.

SCons is a tool traditionally used for compiling programs. An \texttt{SConstruct} file for compilation may look like the following
\lstset{language=python,numbers=left,numberstyle=\tiny,showstringspaces=false}
\begin{lstlisting}
env = Environment()
env.Append(CPPFLAGS=['-Wall','-g'])
env.Program('hello',['hello.c', 'main.c'])
\end{lstlisting}
and produce something like
\begin{verbatim}
bash$ scons -Q
gcc -o hello.o -c -Wall -g hello.c
gcc -o main.o -c -Wall -g main.c
gcc -o hello hello.o main.o
\end{verbatim}
to compile the \texttt{hello} program from the source files \texttt{hello.c} and \texttt{main.c}.

Madagascar uses SCons to compile its programs from the source. The
more frequent usage, however, comes from adopting SCons to manage data
processing flows.

\subsection{Useful SCons options}

The \texttt{scons} program takes a number of options. Some of the commonly used options are:
\begin{description}
  \item[scons -h] (help) displays a help message.
  \item[scons -Q] (quiet) suppresses progress messages.
  \item[scons -n] (no exec) outputs the commands required for building the specified target (or the default targets if no target is specified) without actually executing them. It can be used to generate a shell script out of SConstruct script, as follows:
\begin{verbatim}
scons -nQ > script.sh
\end{verbatim}
\end{description}

\section{Why use SCons?}

In the compilation task, the target (an executible program) may
require multiple sources. The sources may have multiple dependencies
among them. When one of the sources changes, the target should be
recompiled. However, it would be wasteful to compile sources that are
affected by the change. The famous Unix \texttt{make} utility was
developed to keep track of the dependencies and to make the
compilation task more efficient. A free, open-source version of
\texttt{make}, \emph{GNU make}, was developed by Richard Stallman
\cite[]{make}.

Creating data analysis workflows has a lot in common with compiling
programs... SEP...

Better design of SCons...

\section{Managing data processing flows using \texttt{rsf.proj}}

\subsection{Seismic Unix processing using  \texttt{rsf.suproj}}

\section{Creating documents using \texttt{rsf.tex}}

\section{Creating books and reports using \texttt{rsf.book}}

\bibliographystyle{seg}
\bibliography{scons}
